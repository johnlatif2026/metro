<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Metro Cairo Guide</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- AOS for animation -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">

<style>
  body{font-family: "Segoe UI", Tahoma, Arial, sans-serif; background:#f5f7fb;}
  header{background:#0d6efd;color:#fff;padding:36px 12px;text-align:center}
  .card-hover{transition:transform .18s ease, box-shadow .18s ease;}
  .card-hover:hover{transform:translateY(-6px); box-shadow:0 10px 30px rgba(13,110,253,.12);}
  .section-title{font-weight:700}
  .small-muted{font-size:.95rem;color:#6c757d}
  .map-link{cursor:pointer;text-decoration:underline}
  @media(min-width:1200px){
    .container-max{max-width:1100px}
  }
</style>
</head>
<body>

<header>
  <h1 class="mb-1">ğŸš‡ Ø®Ø±ÙŠØ·Ø© / Ø¯Ù„ÙŠÙ„ Ù…ØªØ±Ùˆ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</h1>
  <div class="small-muted">Ø³Ù‡Ù„ Ø±Ø­Ù„ØªÙƒ â€” Ø­Ø¯Ø¯ Ø®Ø·/Ù…Ø­Ø·Ø© Ø§Ùˆ Ø§Ø­Ø³Ø¨ Ø³Ø¹Ø± Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ø³Ø±Ø¹Ø©</div>
</header>

<div class="container container-max mt-4 mb-5">

  <!-- Ø®Ø±Ø§Ø¦Ø· Ùˆ Ø®ÙŠØ§Ø±Ø§Øª -->
  <div class="row g-3 mb-4">
    <div class="col-md-8">
      <div class="card p-3 card-hover" data-aos="fade-up">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="section-title mb-1">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h5>
            <div class="small-muted">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙØªØ­ ØµÙˆØ±Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ØªØ±Ùˆ</div>
          </div>
          <div>
            <a id="mapLink" class="btn btn-outline-primary map-link" target="_blank"
               href="https://i.postimg.cc/x1bzXDr4/IMG-20251201-153808.jpg">
              Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ØªØ±Ùˆ
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card p-3 card-hover" data-aos="fade-up">
        <h6 class="mb-2 section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h6>
        <ul class="mb-0 small-muted">
          <li>ÙƒÙ„ Ù…Ø­Ø·Ø© = 2.5 Ø¯Ù‚ÙŠÙ‚Ø©</li>
          <li>ÙƒÙ„ ØªØ¨Ø¯ÙŠÙ„ (Transfer) ÙŠØ¶Ø§Ù +4 Ø¯Ù‚Ø§Ø¦Ù‚</li>
          <li>Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: 1-9 => 6 Ø¬ØŒ 10-16 => 8 Ø¬ØŒ 17-23 => 12 Ø¬ØŒ Ø£ÙƒØ«Ø± Ù…Ù† 23 => 15 Ø¬</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…: ØªÙØ§ØµÙŠÙ„ Ù…Ø´ÙˆØ§Ø±Ùƒ Ùˆ Ø§Ø­Ø³Ø¨ Ù…Ø´ÙˆØ§Ø±Ùƒ -->
  <div class="row g-4">
    <!-- ØªÙØ§ØµÙŠÙ„ Ù…Ø´ÙˆØ§Ø±Ùƒ -->
    <div class="col-lg-6">
      <div class="card p-3 card-hover" data-aos="fade-right">
        <h5 class="section-title">ğŸ” ØªÙØ§ØµÙŠÙ„ Ù…Ø´ÙˆØ§Ø±Ùƒ</h5>
        <p class="small-muted">Ø§Ø®ØªØ± Ø®Ø· + Ù…Ø­Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ø«Ù… Ø®Ø· + Ù…Ø­Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ ÙˆØ§Ø¶ØºØ· "Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„"</p>

        <div class="row gy-2">
          <div class="col-12 col-md-6">
            <label class="form-label">Ù…Ù† (Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·)</label>
            <select id="fromLine" class="form-select"></select>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Ù…Ù† (Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©)</label>
            <select id="fromStation" class="form-select"></select>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Ø¥Ù„Ù‰ (Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·)</label>
            <select id="toLine" class="form-select"></select>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Ø¥Ù„Ù‰ (Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©)</label>
            <select id="toStation" class="form-select"></select>
          </div>
        </div>

        <div class="d-grid mt-3">
          <button id="btnDetails" class="btn btn-primary">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
        </div>

        <hr>

        <div id="detailsResult" class="mt-2"></div>
      </div>
    </div>

    <!-- Ø§Ø­Ø³Ø¨ Ù…Ø´ÙˆØ§Ø±Ùƒ -->
    <div class="col-lg-6">
      <div class="card p-3 card-hover" data-aos="fade-left">
        <h5 class="section-title">ğŸ§® Ø§Ø­Ø³Ø¨ Ù…Ø´ÙˆØ§Ø±Ùƒ (Ø¹Ø¯Ø¯ Ø£Ø´Ø®Ø§Øµ)</h5>
        <p class="small-muted">Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø¢Ù„ÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ø¹Ø¯Ø© Ø£Ø´Ø®Ø§Øµ</p>

        <div class="row gy-2">
          <div class="col-12 col-md-6">
            <label class="form-label">Ù…Ù† (Ø®Ø·)</label>
            <select id="cFromLine" class="form-select"></select>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Ù…Ù† (Ù…Ø­Ø·Ø©)</label>
            <select id="cFromStation" class="form-select"></select>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Ø¥Ù„Ù‰ (Ø®Ø·)</label>
            <select id="cToLine" class="form-select"></select>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Ø¥Ù„Ù‰ (Ù…Ø­Ø·Ø©)</label>
            <select id="cToStation" class="form-select"></div>

          <div class="col-12 col-md-6">
            <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ</label>
            <input id="people" type="number" min="1" value="1" class="form-control" />
          </div>

        </div>

        <div class="d-grid mt-3">
          <button id="btnCalc" class="btn btn-success">Ø§Ø­Ø³Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©</button>
        </div>

        <hr>

        <div id="calcResult" class="mt-2"></div>
      </div>
    </div>
  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ù…Ø­Ø·Ø§Øª -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card p-3 card-hover" data-aos="fade-up">
        <h5 class="section-title">ğŸ“ Ø®Ø·ÙˆØ· ÙˆÙ…Ø­Ø·Ø§Øª Ø§Ù„Ù…ØªØ±Ùˆ (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)</h5>
        <div id="linesContainer" class="row g-3 mt-2"></div>
      </div>
    </div>
  </div>

  <footer class="text-center small-muted mt-4 mb-3">ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ… â€” Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ âœ¨</footer>

</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script>AOS.init();</script>

<script>
// -----------------------------
// Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† data.json
// -----------------------------
let dataGlobal = null;

fetch('data.json')
.then(r => r.json())
.then(data => {
  dataGlobal = data;
  populateLineSelectors();
  renderLinesList();
})
.catch(err => {
  console.error(err);
  alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ data.json â€” ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯.');
});

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ DOM
const fromLine = document.getElementById('fromLine');
const toLine   = document.getElementById('toLine');
const fromStation = document.getElementById('fromStation');
const toStation   = document.getElementById('toStation');

const cFromLine = document.getElementById('cFromLine');
const cToLine = document.getElementById('cToLine');
const cFromStation = document.getElementById('cFromStation');
const cToStation = document.getElementById('cToStation');

const btnDetails = document.getElementById('btnDetails');
const detailsResult = document.getElementById('detailsResult');

const btnCalc = document.getElementById('btnCalc');
const calcResult = document.getElementById('calcResult');

const linesContainer = document.getElementById('linesContainer');

// Ù…ÙØ¹ÙŠÙ†Ø§Øª Ø«Ø§Ø¨ØªØ©
const MINUTES_PER_STATION = 2.5;
const MINUTES_PER_TRANSFER = 4;

// fares function
function fareForStations(n){
  if (n <= 0) return 0;
  if (n <= 9) return 6;
  if (n <= 16) return 8;
  if (n <= 23) return 12;
  return 15; // Ø£ÙƒØ«Ø± Ù…Ù† 23
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
function populateLineSelectors(){
  dataGlobal.lines.forEach(line=>{
    const opt = `<option value="${line.id}">${line.name}</option>`;
    fromLine.insertAdjacentHTML('beforeend', opt);
    toLine.insertAdjacentHTML('beforeend', opt);
    cFromLine.insertAdjacentHTML('beforeend', opt);
    cToLine.insertAdjacentHTML('beforeend', opt);
  });
  // Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·ÙˆØ·ØŒ Ø§Ù…Ù„Ø£ Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø®Ø· Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  fillStationsForSelect(fromLine.value, fromStation);
  fillStationsForSelect(toLine.value, toStation);
  fillStationsForSelect(cFromLine.value, cFromStation);
  fillStationsForSelect(cToLine.value, cToStation);
}

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø· Ù†Ø¹Ø¨Ù‘ÙŠ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡
function fillStationsForSelect(lineId, selectEl){
  selectEl.innerHTML = '';
  const line = dataGlobal.lines.find(l=>l.id === lineId);
  if(!line) return;
  line.stations.forEach(s=>{
    const op = document.createElement('option');
    op.value = s;
    op.textContent = s;
    selectEl.appendChild(op);
  });
}

// Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ· Ù„Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
[fromLine, toLine, cFromLine, cToLine].forEach(el=>{
  el.addEventListener('change', e=>{
    if(el === fromLine) fillStationsForSelect(el.value, fromStation);
    if(el === toLine) fillStationsForSelect(el.value, toStation);
    if(el === cFromLine) fillStationsForSelect(el.value, cFromStation);
    if(el === cToLine) fillStationsForSelect(el.value, cToStation);
  });
});

// -----------------------------
// Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø± (Ø­ØªÙ‰ ØªØ¨Ø¯ÙŠÙ„ÙŠÙ†)
// - ØªØ±Ø¬Ø¹ ÙƒØ§Ø¦Ù†: {stationsCount, transfers:Array, pathSegments:Array}
// pathSegments = [{lineId, fromIndex, toIndex, stationsCount}]
//
// Ø§Ù„ÙÙƒØ±Ø©: Ù†Ø¬Ø±Ø¨ Ù…Ø³Ø§Ø± Ù…Ø¨Ø§Ø´Ø± (Ù†ÙØ³ Ø§Ù„Ø®Ø·)ØŒ Ø«Ù… Ù…Ø³Ø§Ø± Ø¨ØªØ¨Ø¯ÙŠÙ„ ÙˆØ§Ø­Ø¯ØŒ Ø«Ù… ØªØ¨Ø¯ÙŠÙ„Ø§Ù† Ø¹Ø¨Ø± Ø®Ø· ÙˆØ³ÙŠØ·
// -----------------------------
function findBestRoute(fromLineId, fromSt, toLineId, toSt){
  const lines = dataGlobal.lines;
  const lineA = lines.find(l=>l.id === fromLineId);
  const lineB = lines.find(l=>l.id === toLineId);
  if(!lineA || !lineB) return null;

  const idxA = lineA.stations.indexOf(fromSt);
  const idxB = lineB.stations.indexOf(toSt);
  if(idxA === -1 || idxB === -1) return null;

  // 1) Ù†ÙØ³ Ø§Ù„Ø®Ø·ØŸ
  if(fromLineId === toLineId){
    const count = Math.abs(idxA - idxB);
    return {
      stationsCount: count,
      transfers: [],
      pathSegments: [{lineId: fromLineId, fromIndex: idxA, toIndex: idxB, stationsCount: count}]
    };
  }

  // 2) ØªØ¨Ø¯ÙŠÙ„ ÙˆØ§Ø­Ø¯ â€” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ø·Ø§Øª Ù…Ø´ØªØ±ÙƒØ© Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙŠÙ†
  const common = lineA.stations.filter(s => lineB.stations.includes(s));
  if(common.length > 0){
    // Ø§Ø®ØªØ± Ù…Ø­Ø·Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙŠ ØªØ¹Ø·ÙŠ Ø£Ù‚Ù„ Ø¹Ø¯Ø¯ Ù…Ø­Ø·Ø§Øª Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    let best = null;
    common.forEach(inter => {
      const idxInterA = lineA.stations.indexOf(inter);
      const idxInterB = lineB.stations.indexOf(inter);
      const count = Math.abs(idxA - idxInterA) + Math.abs(idxB - idxInterB);
      if(best === null || count < best.total) {
        best = { inter, idxInterA, idxInterB, total: count };
      }
    });
    return {
      stationsCount: best.total,
      transfers: [best.inter],
      pathSegments: [
        {lineId: fromLineId, fromIndex: idxA, toIndex: best.idxInterA, stationsCount: Math.abs(idxA-best.idxInterA)},
        {lineId: toLineId, fromIndex: best.idxInterB, toIndex: idxB, stationsCount: Math.abs(idxB-best.idxInterB)}
      ]
    };
  }

  // 3) ØªØ¨Ø¯ÙŠÙ„ÙŠÙ† Ø¹Ø¨Ø± Ø®Ø· ÙˆØ³ÙŠØ· (A -> C -> B)
  // Ø¬Ø±Ø¨ ÙƒÙ„ Ø®Ø· ÙˆØ³ÙŠØ· C != A,B
  let bestTwo = null;
  lines.forEach(lineC => {
    if(lineC.id === fromLineId || lineC.id === toLineId) return;
    // Ø£ÙˆØ¬Ø¯ ØªÙ‚Ø§Ø·Ø¹Ø§Øª A<->C Ùˆ C<->B
    const interAC = lineA.stations.filter(s=>lineC.stations.includes(s));
    const interCB = lineC.stations.filter(s=>lineB.stations.includes(s));
    if(interAC.length === 0 || interCB.length === 0) return;

    // Ø¬Ø±Ø¨ ÙƒÙ„ ØªØ±ÙƒÙŠØ¨Ø© Ù…Ù† Ù…Ø­Ø·Ø§Øª Ø§Ù„ØªØ¨Ø§Ø¯Ù„
    interAC.forEach(iAC => {
      interCB.forEach(iCB => {
        const idx_iAC_A = lineA.stations.indexOf(iAC);
        const idx_iAC_C = lineC.stations.indexOf(iAC);
        const idx_iCB_C = lineC.stations.indexOf(iCB);
        const idx_iCB_B = lineB.stations.indexOf(iCB);

        const total = Math.abs(idxA - idx_iAC_A)
                    + Math.abs(idx_iAC_C - idx_iCB_C)
                    + Math.abs(idxB - idx_iCB_B);
        if(bestTwo === null || total < bestTwo.total){
          bestTwo = {
            total,
            transfers: [iAC, iCB],
            segments: [
              {lineId: fromLineId, fromIndex: idxA, toIndex: idx_iAC_A, stationsCount: Math.abs(idxA - idx_iAC_A)},
              {lineId: lineC.id, fromIndex: idx_iAC_C, toIndex: idx_iCB_C, stationsCount: Math.abs(idx_iAC_C - idx_iCB_C)},
              {lineId: toLineId, fromIndex: idx_iCB_B, toIndex: idxB, stationsCount: Math.abs(idxB - idx_iCB_B)}
            ]
          };
        }
      });
    });
  });

  if(bestTwo) {
    return {
      stationsCount: bestTwo.total,
      transfers: bestTwo.transfers,
      pathSegments: bestTwo.segments
    };
  }

  // Ù„Ùˆ Ù…Ø§ Ù‚Ø¯Ø±Ù†Ø§ Ù†Ù„Ø§Ù‚ÙŠ Ù…Ø³Ø§Ø± (Ù†Ø§Ø¯Ø±)ØŒ Ø±Ø¬Ø¹ null
  return null;
}

// --------------------------------
// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ù…Ø´ÙˆØ§Ø±Ùƒ
// --------------------------------
btnDetails.addEventListener('click', ()=>{
  detailsResult.innerHTML = '... Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨';
  setTimeout(()=>{
    const res = getRouteFromUI();
    if(!res) { detailsResult.innerHTML = '<div class="text-danger">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ù…Ø­Ø·Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.</div>'; return; }

    const route = findBestRoute(res.fromLineId, res.fromStation, res.toLineId, res.toStation);
    if(!route){ detailsResult.innerHTML = '<div class="text-danger">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø³Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ø·ØªÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ØªÙŠÙ†.</div>'; return; }

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø³Ø¹Ø±
    const stationCount = route.stationsCount;
    const transfersCount = route.transfers.length;
    const timeMin = (stationCount * MINUTES_PER_STATION) + (transfersCount * MINUTES_PER_TRANSFER);
    const ticketPrice = fareForStations(stationCount);

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    detailsResult.innerHTML = `
      <div class="mt-2">
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø·Ø§Øª:</strong> ${stationCount}</p>
        <p><strong>Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª:</strong> ${transfersCount === 0 ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯' : route.transfers.join(' âœ ')}</p>
        <p><strong>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:</strong> ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ${timeMin.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©</p>
        <p><strong>Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ø´Ø®Øµ ÙˆØ§Ø­Ø¯:</strong> ${ticketPrice} Ø¬Ù†ÙŠÙ‡</p>
      </div>
      <div class="small-muted mt-2">
        <strong>Ù…Ø®Ø·Ø· Ø§Ù„Ø±Ø­Ù„Ø©:</strong>
        <ul>
          ${route.pathSegments.map(seg=>{
            const line = dataGlobal.lines.find(l=>l.id===seg.lineId);
            const fromName = line.stations[seg.fromIndex];
            const toName = line.stations[seg.toIndex];
            return `<li>${line.name}: Ù…Ù† "${fromName}" Ø¥Ù„Ù‰ "${toName}" â€” ${seg.stationsCount} Ù…Ø­Ø·Ø©</li>`;
          }).join('')}
        </ul>
      </div>
    `;
  },120);
});

// Ø§Ù‚Ø±Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
function getRouteFromUI(){
  return {
    fromLineId: fromLine.value,
    fromStation: fromStation.value,
    toLineId: toLine.value,
    toStation: toStation.value
  };
}

// --------------------------------
// Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ù„Ø¹Ø¯Ø¯ Ø£Ø´Ø®Ø§Øµ
// --------------------------------
btnCalc.addEventListener('click', ()=>{
  calcResult.innerHTML = '... Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨';
  setTimeout(()=>{
    const fromLineId = cFromLine.value;
    const toLineId = cToLine.value;
    const fromSt = cFromStation.value;
    const toSt = cToStation.value;
    const people = Math.max(1, parseInt(document.getElementById('people').value || '1',10));

    const route = findBestRoute(fromLineId, fromSt, toLineId, toSt);
    if(!route){ calcResult.innerHTML = '<div class="text-danger">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø³Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ø·ØªÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ØªÙŠÙ†.</div>'; return; }

    const stationCount = route.stationsCount;
    const transfersCount = route.transfers.length;
    const timeMin = (stationCount * MINUTES_PER_STATION) + (transfersCount * MINUTES_PER_TRANSFER);
    const ticketPrice = fareForStations(stationCount);
    const total = ticketPrice * people;

    calcResult.innerHTML = `
      <div class="mt-2">
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø·Ø§Øª:</strong> ${stationCount}</p>
        <p><strong>Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª:</strong> ${transfersCount === 0 ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯' : route.transfers.join(' âœ ')}</p>
        <p><strong>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:</strong> ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ${timeMin.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©</p>
        <p><strong>Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ø´Ø®Øµ ÙˆØ§Ø­Ø¯:</strong> ${ticketPrice} Ø¬Ù†ÙŠÙ‡</p>
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:</strong> ${people}</p>
        <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ${total} Ø¬Ù†ÙŠÙ‡</p>
      </div>
    `;
  },120);
});

// --------------------------------
// Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ù…Ø­Ø·Ø§Øª
// --------------------------------
function renderLinesList(){
  linesContainer.innerHTML = '';
  dataGlobal.lines.forEach(line=>{
    const col = document.createElement('div');
    col.className = 'col-md-6';

    const html = `
      <div class="p-3 border rounded">
        <h6 style="color:${line.color};margin-bottom:.4rem">${line.name} <small class="small-muted">(${line.stations.length} Ù…Ø­Ø·Ø©)</small></h6>
        <div class="small-muted">${line.stations.join(' â€¢ ')}</div>
      </div>
    `;
    col.innerHTML = html;
    linesContainer.appendChild(col);
  });
}

</script>
</body>
</html>
